@page "{handler?}"
@model PPT.Pages.MonthlyReportsModel
@{
	ViewData["Title"] = "التقرير الشهري";
}
@*
	Let the head of department to view attendance by month 
	and download the exel file for it, by applying a change listener 
	to the month selector(ajax call).
*@
<form >
	<label for="monthSel">الشهر</label>
	<input type="month" id="monthSel" asp-for = "@Model.Date">
	<br /><br />
	<input type="submit" value="تحميل"  asp-page-handler="Download"/>
	<br />
	<br />
</form>


<table id="report" style="display:none; width : 100% ">
	<thead>
		<tr>
			<th>
				الرقم
			</th>
			<th>
				الرقم الجامعي
			</th>
			<th>
				الإسم
			</th>
			<th>
				التاريخ
			</th>
			<th>
				المدة
			</th>
			<th>
				الإصدار
			</th>
		</tr>
	</thead>
	
</table>

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<link href="~/lib/DataTables/datatables.min.css" rel="stylesheet"/>
<script src="~/lib/DataTables/datatables.min.js" defer></script>
<script type="text/javascript">
	$(function () {
		$('#monthSel').change(
			
			function(){
				if($(this).val() == ''){return;} 
				$.ajax({
					url: "/MonthlyReports/Report",
					data: { "date": $(this).val() },
					success: function (result) {
		 //               $.each(result, function (index, item) {

		 //               });
						$('#report').DataTable().destroy();
						$('#report').DataTable({
						paging: false,
						data: result,
						columns: [
							{ data: 'id' },
							{ data: 'uniID' },
							{ data: 'name' },
							{ data: 'date' },
							{ data: 'duration' },
							{ data: 'published' },
						]
						});
					$('#report').show()
					}
				});
		});
	});
</script>